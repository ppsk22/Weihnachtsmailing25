<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Snow Controls</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #050511;
      color: #eee;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(10, 10, 20, 0.85);
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 12px;
      max-width: 260px;
      backdrop-filter: blur(6px);
    }

    #ui h1 {
      margin: 0 0 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .control {
      display: flex;
      flex-direction: column;
      margin-bottom: 6px;
    }

    .control label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
      gap: 4px;
    }

    .control span.value {
      font-variant-numeric: tabular-nums;
      opacity: 0.8;
    }

    .control input[type="range"] {
      width: 100%;
    }

    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="ui">
    <h1>Pixel Snow Controls</h1>

    <div class="control">
      <label>
        <span>Density</span>
        <span class="value" id="densityValue"></span>
      </label>
      <input type="range" id="density" min="0.01" max="0.25" step="0.01" value="0.08">
    </div>

    <div class="control">
      <label>
        <span>Size min (px)</span>
        <span class="value" id="sizeMinValue"></span>
      </label>
      <input type="range" id="sizeMin" min="1" max="5" step="1" value="1">
    </div>

    <div class="control">
      <label>
        <span>Size max (px)</span>
        <span class="value" id="sizeMaxValue"></span>
      </label>
      <input type="range" id="sizeMax" min="2" max="8" step="1" value="3">
    </div>

    <div class="control">
      <label>
        <span>Fall min</span>
        <span class="value" id="fallMinValue"></span>
      </label>
      <input type="range" id="fallMin" min="0.1" max="2" step="0.1" value="0.3">
    </div>

    <div class="control">
      <label>
        <span>Fall max</span>
        <span class="value" id="fallMaxValue"></span>
      </label>
      <input type="range" id="fallMax" min="0.5" max="4" step="0.1" value="1.2">
    </div>

    <div class="control">
      <label>
        <span>Wind</span>
        <span class="value" id="windValue"></span>
      </label>
      <input type="range" id="wind" min="-1.5" max="1.5" step="0.05" value="0">
    </div>

    <div class="control">
      <label>
        <span>Wobble amp</span>
        <span class="value" id="wobbleAmpValue"></span>
      </label>
      <input type="range" id="wobbleAmp" min="0" max="4" step="0.1" value="1.5">
    </div>

    <div class="control">
      <label>
        <span>Wobble speed</span>
        <span class="value" id="wobbleSpeedValue"></span>
      </label>
      <input type="range" id="wobbleSpeed" min="0.001" max="0.02" step="0.001" value="0.006">
    </div>

    <div class="control">
      <label>
        <span>FPS</span>
        <span class="value" id="fpsValue"></span>
      </label>
      <input type="range" id="fps" min="1" max="60" step="1" value="60">
    </div>
  </div>

  <canvas id="pixelSnow"></canvas>

  <script>
    const canvas = document.getElementById('pixelSnow');
    const ctx = canvas.getContext('2d');

    const settings = {
      density: 0.08,     // scalar
      sizeMin: 1,
      sizeMax: 3,
      fallMin: 0.3,
      fallMax: 1.2,
      wind: 0,           // added to each particle's base vx
      wobbleAmp: 1.5,
      wobbleSpeed: 0.006,
      fps: 60
    };

    // UI hook-up
    const sliders = {
      density: document.getElementById('density'),
      sizeMin: document.getElementById('sizeMin'),
      sizeMax: document.getElementById('sizeMax'),
      fallMin: document.getElementById('fallMin'),
      fallMax: document.getElementById('fallMax'),
      wind: document.getElementById('wind'),
      wobbleAmp: document.getElementById('wobbleAmp'),
      wobbleSpeed: document.getElementById('wobbleSpeed'),
      fps: document.getElementById('fps')
    };

    const labels = {
      density: document.getElementById('densityValue'),
      sizeMin: document.getElementById('sizeMinValue'),
      sizeMax: document.getElementById('sizeMaxValue'),
      fallMin: document.getElementById('fallMinValue'),
      fallMax: document.getElementById('fallMaxValue'),
      wind: document.getElementById('windValue'),
      wobbleAmp: document.getElementById('wobbleAmpValue'),
      wobbleSpeed: document.getElementById('wobbleSpeedValue'),
      fps: document.getElementById('fpsValue')
    };

    function updateLabel(key, formatter) {
      const val = settings[key];
      labels[key].textContent = formatter ? formatter(val) : String(val);
    }

    function hookSlider(key, parseFn, formatter, regenerate) {
      const slider = sliders[key];
      settings[key] = parseFn(slider.value);
      updateLabel(key, formatter);

      slider.addEventListener('input', () => {
        settings[key] = parseFn(slider.value);
        updateLabel(key, formatter);
        if (regenerate) regeneratePixels();
      });
    }

    let pixels = [];
    let canvasWidth = 0;
    let canvasHeight = 0;

    function resizeCanvas() {
      canvasWidth = window.innerWidth;
      canvasHeight = window.innerHeight;
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;
      regeneratePixels();
    }

    function clampSizeSettings() {
      if (settings.sizeMin > settings.sizeMax) {
        const tmp = settings.sizeMin;
        settings.sizeMin = settings.sizeMax;
        settings.sizeMax = tmp;
        sliders.sizeMin.value = settings.sizeMin;
        sliders.sizeMax.value = settings.sizeMax;
        updateLabel('sizeMin');
        updateLabel('sizeMax');
      }
      if (settings.fallMin > settings.fallMax) {
        const tmp = settings.fallMin;
        settings.fallMin = settings.fallMax;
        settings.fallMax = tmp;
        sliders.fallMin.value = settings.fallMin;
        sliders.fallMax.value = settings.fallMax;
        updateLabel('fallMin');
        updateLabel('fallMax');
      }
    }

    function regeneratePixels() {
      clampSizeSettings();
      const area = canvasWidth * canvasHeight;
      const count = Math.max(50, Math.floor(area * settings.density / 10)); // crude, works fine

      pixels = [];
      for (let i = 0; i < count; i++) {
        pixels.push(makePixel());
      }
    }

    function randRange(min, max) {
      return min + Math.random() * (max - min);
    }

    function makePixel() {
      return {
        x: Math.random() * canvasWidth,
        y: Math.random() * canvasHeight,
        size: Math.max(1, Math.round(randRange(settings.sizeMin, settings.sizeMax))),
        vy: randRange(settings.fallMin, settings.fallMax),
        baseVx: (Math.random() - 0.5) * 0.4, // base horizontal drift
        alpha: 0.5 + Math.random() * 0.5,
        wobblePhase: Math.random() * Math.PI * 2,
        wobbleSpeed: randRange(settings.wobbleSpeed * 0.5, settings.wobbleSpeed * 1.5),
        wobbleAmp: randRange(settings.wobbleAmp * 0.5, settings.wobbleAmp * 1.5)
      };
    }

    let lastTime = 0;

    function loop(timestamp) {
      requestAnimationFrame(loop);

      if (!lastTime) lastTime = timestamp;
      const frameInterval = 1000 / settings.fps;
      const delta = timestamp - lastTime;
      if (delta < frameInterval) return;
      const dt = delta / (1000 / 60); // normalize to 60fps-ish
      lastTime = timestamp;

      ctx.clearRect(0, 0, canvasWidth, canvasHeight);

      for (let i = 0; i < pixels.length; i++) {
        const p = pixels[i];

        const vx = (p.baseVx + settings.wind);
        p.y += p.vy * dt;
        p.x += vx * dt;
        p.wobblePhase += p.wobbleSpeed * dt;
        const wobble = Math.sin(p.wobblePhase) * p.wobbleAmp;
        const drawX = p.x + wobble;

        if (p.y > canvasHeight + 10) {
          p.y = -10;
          p.x = Math.random() * canvasWidth;
        }

        if (drawX < -10) p.x = canvasWidth + 10;
        if (drawX > canvasWidth + 10) p.x = -10;

        ctx.globalAlpha = p.alpha;
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(drawX, p.y, p.size, p.size);
      }

      ctx.globalAlpha = 1;
    }

    // Initialize sliders
    hookSlider('density', v => parseFloat(v), v => v.toFixed(2), true);
    hookSlider('sizeMin', v => parseInt(v, 10), null, true);
    hookSlider('sizeMax', v => parseInt(v, 10), null, true);
    hookSlider('fallMin', v => parseFloat(v), v => v.toFixed(1), true);
    hookSlider('fallMax', v => parseFloat(v), v => v.toFixed(1), true);
    hookSlider('wind', v => parseFloat(v), v => v.toFixed(2), false);
    hookSlider('wobbleAmp', v => parseFloat(v), v => v.toFixed(1), true);
    hookSlider('wobbleSpeed', v => parseFloat(v), v => v.toFixed(3), true);
    hookSlider('fps', v => parseInt(v, 10), null, false);

    window.addEventListener('resize', resizeCanvas);

    resizeCanvas();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
