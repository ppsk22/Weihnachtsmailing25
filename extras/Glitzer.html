<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Art Glitter</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #050511;
      color: #eee;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #ui {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(10, 10, 20, 0.9);
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 12px;
      max-width: 260px;
      backdrop-filter: blur(6px);
    }

    #ui h1 {
      margin: 0 0 6px;
      font-size: 13px;
      font-weight: 600;
    }

    .control {
      display: flex;
      flex-direction: column;
      margin-bottom: 6px;
    }

    .control label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2px;
      gap: 4px;
    }

    .control span.value {
      font-variant-numeric: tabular-nums;
      opacity: 0.8;
    }

    .control input[type="range"] {
      width: 100%;
    }

    .color-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .color-row input[type="color"] {
      width: 40px;
      height: 18px;
      padding: 0;
      border: none;
      background: transparent;
    }

    canvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="ui">
    <h1>Pixel Glitter Controls</h1>

    <div class="control">
      <label>
        <span>Dichte</span>
        <span class="value" id="densityValue"></span>
      </label>
      <input type="range" id="density" min="0.01" max="0.35" step="0.01" value="0.12">
    </div>

    <div class="control">
      <label>
        <span>Größe min (px)</span>
        <span class="value" id="sizeMinValue"></span>
      </label>
      <input type="range" id="sizeMin" min="1" max="4" step="1" value="1">
    </div>

    <div class="control">
      <label>
        <span>Größe max (px)</span>
        <span class="value" id="sizeMaxValue"></span>
      </label>
      <input type="range" id="sizeMax" min="2" max="20" step="1" value="7">
    </div>

    <div class="control">
      <label>
        <span>Glitter Intensity</span>
        <span class="value" id="glitterAmountValue"></span>
      </label>
      <input type="range" id="glitterAmount" min="0" max="1" step="0.05" value="0.9">
    </div>

    <div class="control">
      <label>
        <span>Glitter Speed</span>
        <span class="value" id="glitterSpeedValue"></span>
      </label>
      <input type="range" id="glitterSpeed" min="0.001" max="0.04" step="0.001" value="0.015">
    </div>

    <div class="control">
      <label>
        <span>Jitter (px)</span>
        <span class="value" id="jitterValue"></span>
      </label>
      <input type="range" id="jitter" min="0" max="2" step="0.1" value="0.6">
    </div>

    <div class="control">
      <label>
        <span>Cross Chance</span>
        <span class="value" id="crossChanceValue"></span>
      </label>
      <input type="range" id="crossChance" min="0" max="1" step="0.05" value="1">
    </div>

    <div class="control">
      <label>
        <span>FPS</span>
        <span class="value" id="fpsValue"></span>
      </label>
      <input type="range" id="fps" min="1" max="60" step="1" value="60">
    </div>

    <div class="control">
      <label>
        <span>Farbe 1</span>
        <span class="value" id="color1Value"></span>
      </label>
      <div class="color-row">
        <input type="color" id="color1" value="#ffe6f6">
      </div>
    </div>

    <div class="control">
      <label>
        <span>Farbe 2</span>
        <span class="value" id="color2Value"></span>
      </label>
      <div class="color-row">
        <input type="color" id="color2" value="#a5f0ff">
      </div>
    </div>
  </div>

  <canvas id="glitterCanvas"></canvas>

  <script>
    const canvas = document.getElementById('glitterCanvas');
    const ctx = canvas.getContext('2d');

    const settings = {
      density: 0.12,
      sizeMin: 1,
      sizeMax: 3,
      glitterAmount: 0.9,
      glitterSpeed: 0.015,
      jitter: 0.6,
      crossChance: 1,
      fps: 60,
      color1: '#ffe6f6',
      color2: '#a5f0ff'
    };

    const sliders = {
      density: document.getElementById('density'),
      sizeMin: document.getElementById('sizeMin'),
      sizeMax: document.getElementById('sizeMax'),
      glitterAmount: document.getElementById('glitterAmount'),
      glitterSpeed: document.getElementById('glitterSpeed'),
      jitter: document.getElementById('jitter'),
      crossChance: document.getElementById('crossChance'),
      fps: document.getElementById('fps')
    };

    const labels = {
      density: document.getElementById('densityValue'),
      sizeMin: document.getElementById('sizeMinValue'),
      sizeMax: document.getElementById('sizeMaxValue'),
      glitterAmount: document.getElementById('glitterAmountValue'),
      glitterSpeed: document.getElementById('glitterSpeedValue'),
      jitter: document.getElementById('jitterValue'),
      crossChance: document.getElementById('crossChanceValue'),
      fps: document.getElementById('fpsValue'),
      color1: document.getElementById('color1Value'),
      color2: document.getElementById('color2Value')
    };

    const colorInputs = {
      color1: document.getElementById('color1'),
      color2: document.getElementById('color2')
    };

    function updateLabel(key, formatter) {
      const val = settings[key];
      labels[key].textContent = formatter ? formatter(val) : String(val);
    }

    function hookSlider(key, parseFn, formatter, regenerate) {
      const slider = sliders[key];
      settings[key] = parseFn(slider.value);
      updateLabel(key, formatter);

      slider.addEventListener('input', () => {
        settings[key] = parseFn(slider.value);
        updateLabel(key, formatter);
        if (regenerate) regenerateGlitter();
      });
    }

    function hookColor(key) {
      const input = colorInputs[key];
      settings[key] = input.value;
      updateLabel(key);

      input.addEventListener('input', () => {
        settings[key] = input.value;
        updateLabel(key);
      });
    }

    let pixels = [];
    let canvasWidth = 0;
    let canvasHeight = 0;

    function resizeCanvas() {
      canvasWidth = window.innerWidth;
      canvasHeight = window.innerHeight;
      canvas.width = canvasWidth;
      canvas.height = canvasHeight;
      regenerateGlitter();
    }

    function clampSizeRange() {
      if (settings.sizeMin > settings.sizeMax) {
        const tmp = settings.sizeMin;
        settings.sizeMin = settings.sizeMax;
        settings.sizeMax = tmp;
        sliders.sizeMin.value = settings.sizeMin;
        sliders.sizeMax.value = settings.sizeMax;
        updateLabel('sizeMin');
        updateLabel('sizeMax');
      }
    }

    function regenerateGlitter() {
      clampSizeRange();
      const area = canvasWidth * canvasHeight;
      const count = Math.max(80, Math.floor(area * settings.density / 10));

      pixels = [];
      for (let i = 0; i < count; i++) {
        pixels.push(makePixel());
      }
    }

    function randRange(min, max) {
      return min + Math.random() * (max - min);
    }

    function makePixel() {
      const size = Math.max(1, Math.round(randRange(settings.sizeMin, settings.sizeMax)));
      return {
        x: Math.random() * canvasWidth,
        y: Math.random() * canvasHeight,
        baseSize: size,
        alphaBase: 0.4 + Math.random() * 0.6,
        phase: Math.random() * Math.PI * 2,
        speed: randRange(settings.glitterSpeed * 0.5, settings.glitterSpeed * 1.5),
        localAmount: 0.4 + Math.random() * 0.6,
        colorIndex: Math.random() < 0.5 ? 0 : 1,
        isCross: Math.random() < settings.crossChance
      };
    }

    let lastTime = 0;

    function loop(timestamp) {
      requestAnimationFrame(loop);

      if (!lastTime) lastTime = timestamp;
      const frameInterval = 1000 / settings.fps;
      const delta = timestamp - lastTime;
      if (delta < frameInterval) return;
      const dt = delta / (1000 / 60);
      lastTime = timestamp;

      ctx.clearRect(0, 0, canvasWidth, canvasHeight);

      for (let i = 0; i < pixels.length; i++) {
        const p = pixels[i];

        p.phase += p.speed * dt;
        const pulse = (1 + Math.sin(p.phase)) / 2; // 0..1

        const amount = settings.glitterAmount * p.localAmount;
        const alpha = p.alphaBase * (0.3 + amount * pulse);
        const size = p.baseSize * (0.7 + 0.7 * amount * pulse);

        // leichter 1px-Jitter
        const jitter = settings.jitter;
        const jx = (Math.random() - 0.5) * jitter;
        const jy = (Math.random() - 0.5) * jitter;

        ctx.globalAlpha = alpha;
        ctx.fillStyle = p.colorIndex === 0 ? settings.color1 : settings.color2;

        const x = p.x + jx;
        const y = p.y + jy;

        if (p.isCross && size >= 2) {
          // kleines Pixel-Kreuz
          const s = Math.round(size);
          const half = Math.floor(s / 2);
          ctx.fillRect(x - half, y, s, 1);     // horizontal
          ctx.fillRect(x, y - half, 1, s);     // vertikal
        } else {
          ctx.fillRect(x, y, size, size);      // simple Pixel
        }
      }

      ctx.globalAlpha = 1;
    }

    // Init sliders
    hookSlider('density', v => parseFloat(v), v => v.toFixed(2), true);
    hookSlider('sizeMin', v => parseInt(v, 10), null, true);
    hookSlider('sizeMax', v => parseInt(v, 10), null, true);
    hookSlider('glitterAmount', v => parseFloat(v), v => v.toFixed(2), false);
    hookSlider('glitterSpeed', v => parseFloat(v), v => v.toFixed(3), false);
    hookSlider('jitter', v => parseFloat(v), v => v.toFixed(1), false);
    hookSlider('crossChance', v => parseFloat(v), v => v.toFixed(2), true);
    hookSlider('fps', v => parseInt(v, 10), null, false);

    // Init colors
    hookColor('color1');
    hookColor('color2');

    window.addEventListener('resize', resizeCanvas);

    resizeCanvas();
    requestAnimationFrame(loop);
  </script>
</body>
</html>
